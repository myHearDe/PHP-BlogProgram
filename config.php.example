<?php
/**
 * 博客系统配置文件
 * 此文件包含系统运行所需的所有配置信息
 * 请勿将此文件暴露在公共可访问的目录下
 */

/**
 * 数据库配置
 */
// 数据库主机地址
define('DB_HOST', 'localhost');

// 数据库用户名
define('DB_USER', 'root');

// 数据库密码
define('DB_PASS', '');

// 数据库名称
define('DB_NAME', 'blog');

// 数据库端口
define('DB_PORT', '3306');

/**
 * SSL 设置
 * 如果您的数据库服务器需要SSL连接，请启用以下设置
 */
// 是否启用SSL连接
define('DB_SSL', false);

// SSL密钥文件路径
define('DB_SSL_KEY', '');

// SSL证书文件路径
define('DB_SSL_CERT', '');

// SSL CA证书文件路径
define('DB_SSL_CA', '');

// SSL加密算法
define('DB_SSL_CIPHER', '');

/**
 * 博客基本信息
 */
// 博客标题
define('BLOG_TITLE', '我的博客');

// 博客描述
define('BLOG_DESCRIPTION', '欢迎访问我的博客');

// 作者名称
define('AUTHOR_NAME', '博主');

// 作者电子邮箱
define('AUTHOR_EMAIL', 'admin@example.com');

/**
 * 显示设置
 */
// 每页显示的文章数量
define('POSTS_PER_PAGE', 5);

// 每页显示的评论数量
define('COMMENTS_PER_PAGE', 10);

/**
 * 路径设置
 */
// 管理后台URL前缀
define('ADMIN_URL', 'admin');

/**
 * 时区设置
 */
define('TIMEZONE', 'Asia/Shanghai');

// 设置PHP时区
date_default_timezone_set(TIMEZONE);

/**
 * 日期格式设置
 */
define('DATE_FORMAT', 'Y-m-d H:i:s');

/**
 * 调试模式
 * 开发环境下可以启用，生产环境请务必关闭
 */
define('DEBUG_MODE', false);

// 根据调试模式设置错误报告
if (DEBUG_MODE) {
    error_reporting(E_ALL);
    ini_set('display_errors', 1);
} else {
    error_reporting(0);
    ini_set('display_errors', 0);
}

/**
 * 创建数据库连接
 */
try {
    // 构建DSN字符串
    $dsn = "mysql:host=" . DB_HOST . ";port=" . DB_PORT . ";dbname=" . DB_NAME . ";charset=utf8mb4";
    
    // SSL选项（如果启用）
    $options = [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        PDO::ATTR_EMULATE_PREPARES => false
    ];
    
    // 如果启用了SSL，添加SSL选项
    if (DB_SSL) {
        $ssl_options = [];
        if (!empty(DB_SSL_KEY)) $ssl_options[PDO::MYSQL_ATTR_SSL_KEY] = DB_SSL_KEY;
        if (!empty(DB_SSL_CERT)) $ssl_options[PDO::MYSQL_ATTR_SSL_CERT] = DB_SSL_CERT;
        if (!empty(DB_SSL_CA)) $ssl_options[PDO::MYSQL_ATTR_SSL_CA] = DB_SSL_CA;
        if (!empty(DB_SSL_CIPHER)) $ssl_options[PDO::MYSQL_ATTR_SSL_CIPHER] = DB_SSL_CIPHER;
        
        // 合并选项
        $options = array_merge($options, $ssl_options);
    }
    
    // 创建PDO实例
    $pdo = new PDO($dsn, DB_USER, DB_PASS, $options);
    
    // 定义数据库连接常量
    define('DB_CONNECTED', true);
    define('DB_TYPE', 'mysql');
    define('DB_PERSISTENT', false);
    define('DB_CHARSET', 'utf8mb4');
    define('DB_PREFIX', '');
    
} catch (PDOException $e) {
    // 数据库连接失败
    if (DEBUG_MODE) {
        die('数据库连接失败: ' . $e->getMessage());
    } else {
        die('系统错误，请联系管理员');
    }
}